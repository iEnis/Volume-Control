async function s(t,e){if(e.startsWith("chrome://")||e.startsWith("chrome-extension://"))return;let o=new URL(e).hostname,r=(await chrome.storage.local.get([o]))[o]??1;chrome.scripting.executeScript({target:{tabId:t},func:u=>{let d=window.AudioContext||window.webkitAudioContext;if(!d)return;window._audioCtx||(window._audioCtx=new d,window._gainNode=window._audioCtx.createGain(),window._gainNode.connect(window._audioCtx.destination));let i=window._audioCtx,c=window._gainNode;i.state==="suspended"&&i.resume(),c.gain.value=u,document.querySelectorAll("audio, video").forEach(a=>{if(!a._sourceNode)try{let n=i.createMediaElementSource(a);n.connect(c),a._sourceNode=n}catch(n){console.warn("Already connected element skipped:",n)}})},args:[r]})}chrome.tabs.onUpdated.addListener(async(t,e,o)=>{e.status==="complete"&&o.url&&await s(t,o.url)});chrome.tabs.onActivated.addListener(async({tabId:t})=>{let e=await chrome.tabs.get(t);e.url&&await s(t,e.url)});
