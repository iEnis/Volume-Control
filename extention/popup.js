var e=class n{constructor(){}static label;static slider;static button;static title;static async getCurrentDomain(){let r=(await chrome.tabs.query({active:!0,currentWindow:!0}))[0];return!r.id||!r.url?void 0:new URL(r.url).hostname}static async load(){let t=await this.getCurrentDomain();if(!t)return;n.title.innerText=t;let r=(await chrome.storage.local.get([t]))?.[t]||1;if(console.log(`Volume: ${JSON.stringify(r)}`),!r)return;this.label.textContent=`${Math.round(r*100)}%`,this.slider.value=(r*10).toString();let o=(Number(n.slider.value)-Number(n.slider.min))/(Number(n.slider.max)-Number(n.slider.min))*100;n.slider.style.background=`linear-gradient(to right, var(--primary-color) 0%, var(--primary-color) ${o}%, var(--secondary-color) ${o}%, var(--secondary-color) 100%)`}static async storeData(t,r){typeof r!="string"&&(r=await this.getCurrentDomain()),r&&(await chrome.storage.local.set({[r]:t}),console.log((await chrome.storage.local.get([r]))?.[r]))}static async setVolume(t,r){let i=await this.getCurrentDomain();i&&(this.storeData(t,i),chrome.scripting.executeScript({target:{tabId:r.id},func:o=>{let u=window.AudioContext||window.webkitAudioContext;if(!u)return;window._audioCtx||(window._audioCtx=new u,window._gainNode=window._audioCtx.createGain(),window._gainNode.connect(window._audioCtx.destination));let{_audioCtx:s,_gainNode:d}=window;s.state==="suspended"&&s.resume(),d.gain.value=o,document.querySelectorAll("audio, video").forEach(l=>{if(!l._sourceNode)try{let a=s.createMediaElementSource(l);a.connect(d),l._sourceNode=a}catch(a){console.warn("Already connected element skipped:",a)}})},args:[t]}))}};function m(){e.slider.addEventListener("input",async()=>{c();let n=Number(e.slider.value)/10;e.label.textContent=`${Math.round(n*100)}%`;let[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(t.url?.startsWith("chrome://")||t.url?.startsWith("chrome-extension://"))return console.error("Cannot modify internal Chrome pages");await e.setVolume(n,t)})}function c(){let t=(Number(e.slider.value)-Number(e.slider.min))/(Number(e.slider.max)-Number(e.slider.min))*100;e.slider.style.background=`linear-gradient(to right, var(--primary-color) 0%, var(--primary-color) ${t}%, var(--secondary-color) ${t}%, var(--secondary-color) 100%)`}function b(){e.button.addEventListener("click",async()=>{e.label.textContent="100%",e.slider.value="10",c();let[n]=await chrome.tabs.query({active:!0,currentWindow:!0});if(n.url?.startsWith("chrome://")||n.url?.startsWith("chrome-extension://"))return console.error("Cannot modify internal Chrome pages");await e.setVolume(1,n)})}e.title=document.getElementById("title");e.slider=document.getElementById("volume");e.label=document.getElementById("label");e.button=document.getElementById("reset");await e.load();m();b();
